{% extends "layout.html" %}

{% block title %}
    Video Stream
{% endblock %}

{% block main %}

<!-- All cameras from first index to last in cameras-->
<div class="grid">
 {% for camera_number in range(0, camera_list)%}
   
        <!-- List id is the camera number from the for loop-->
        <div class="contain" id="camera-{{camera_number}}">
            <span class="rec-contain" id="rec-contain">
            <span class="material-symbols-outlined" style="color: #e74c3c;" id="rec-icon">
                radio_button_checked
                </span> REC
            </span>    
            <img src="{{ url_for('video_feed', list_id = camera_number) }}" class="grid-img" width="320" height="240" onclick="openFullScreen(this)">
        <div class="topnav">
            <!--  <span>Camera {{camera_number}}</span>-->
             <!-- <button type="button" onclick="removeCamera('{{camera_number}}')" id="clear">
                  Clear</button>-->
                  
          <button type="button" onclick="startRecording('{{ camera_number }}')" id="record">
              Record
          </button> 
         <button type="button" onclick="stopRecording('{{ camera_number }}')" id="stop">
              STOP
          </button>
          <span class="menu-icon" onclick="">
            <i class="material-icons md-18" id="img-menu" onclick="">more_vert
            </i>
        </span>
         
         
         <!-- <button type="button" onclick="detectMotion('{{ camera_number }}')" id="stop">
            Detect
        </button>
        <button type="button" onclick="stopMotion('{{ camera_number }}')" id="stop">
            *
        </button>-->
          </div>  
        </div>

 {%endfor%}  
</div> 

  <script>
    // Camera_id argument that we'll process into a camera channel in the python code

    var isRecording = false;



    function detectMotion(camera_id) {
        console.log(`Detecting motion for camera ${camera_id}`);
        fetch(`/detect_motion/${camera_id}`, {method: "POST"});
    }

    function stopMotion(camera_id) {
        console.log(`Stopping motion detection for camera ${camera_id}`);
        fetch(`/stop_motion/${camera_id}`, {method: "POST"})
    }

    function openFullScreen(element) {
        if (element.requestFullscreen) 
        {
            element.requestFullscreen();
        } 

        else if (element.mozRequestFullScreen)
        { // Firefox
            element.mozRequestFullScreen();
        } 

        else if (element.webkitRequestFullscreen) 
        { 
            // Chrome, Safari, and Opera
            element.webkitRequestFullscreen();
        } 

        else if (element.msRequestFullscreen) 
        { 
            // IE/Edge
            element.msRequestFullscreen();
        }
    }



    function startRecording(camera_id) {
        console.log(`Starting recording for camera ${camera_id}`);
        // Post request to /start_rec, passing the value of camera_id into the url. We'll collect that inside our python function for recording and process it into a camera channel
        fetch(`/start_rec/${camera_id}`, {method:"POST"})
        .then (response => {
            console.log('response.status: ', response.status);
            if (response.ok) {

                document.getElementById("rec-contain").classList.add("displayRec");
            }
        })

        .catch(err => {
            console.log(err);
        });
        

    }


    // Camera_id argument that we'll process into a camera channel in the python code 
    function stopRecording(camera_id) {
        console.log(`Stopping recording for camera ${camera_id}`);
        // Post request to /stop_rec, passing the value of camera_id into the url. We'll collect that inside our python function for stop-recording and process it into a camera channel
        fetch(`/stop_rec/${camera_id}`, {method: "POST"})
        .then (response => {
            console.log('response.status: ', response.status);
            if (response.ok) {
                document.getElementById("rec-contain").classList.remove("displayRec");
            }
        })
        
    
    }

    function removeCamera(camera_id) {
        console.log(`Removing camera ${camera_id}`);
        fetch(`/remove/${camera_id}`, {
            method: "POST",
        })

        .then (response => {
            if (response.ok) {
                return response.json();
            } else {
                console.error("Error removing camera");
                throw new Error ('Error removing camera');
            }
        })

        .then (data => {
            if (data.success) {
                // Remove camea from UI
                const cameraElement = document.getElementById(`camera-${camera_id}`)
                if (cameraElement) {
                    cameraElement.remove();
                }
            }
        })

        .catch(error=> console.error('Fetch error:', error));
    }
    

  </script>

  {% endblock %}  
